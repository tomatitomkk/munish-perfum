<!DOCTYPE html>
<html lang="es">
<head>
    <title>Finalizar Compra - Fraganze Perfumes</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Completa tu compra de forma segura">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/vendor.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="css/checkout.css">
    <link rel="stylesheet" type="text/css" href="css/mobile-responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@200;300;400;500;600;700&family=Jost:wght@200;300;400;500&display=swap" rel="stylesheet">
</head>
<body class="bg-body">
    <!-- Header -->
    <header id="header" class="site-header text-black bg-primary">
        <nav id="header-nav" class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand brand-text" href="index.html">
                    <span class="brand-name">Munish Perfum</span>
                </a>
                <a href="cart.html" onclick="try{updateCartBadge();}catch(e){}" class="ms-3 cart-link d-inline-flex align-items-center" aria-label="Carrito">
                    <span class="cart-icon me-2">üõí</span>
                    <span class="cart-badge">0</span>
                </a>
            </div>
        </nav>
    </header>

    <!-- Checkout Section -->
    <section class="checkout-section py-5">
        <div class="container">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Inicio</a></li>
                    <li class="breadcrumb-item"><a href="shop.html">Tienda</a></li>
                    <li class="breadcrumb-item"><a href="cart.html">Carrito</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Pago</li>
                </ol>
            </nav>

            <!-- Progress Steps -->
            <div class="checkout-steps mb-5 d-flex justify-content-center flex-wrap">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <span>Informaci√≥n</span>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <span>Pago</span>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <span>Confirmaci√≥n</span>
                </div>
            </div>

            <div class="row">
                <!-- Formulario -->
                <div class="col-lg-7 mb-4">
                    <div class="checkout-form-container">
                        <h2 class="mb-4">Informaci√≥n de Env√≠o</h2>
                        
                        <form id="checkout-form">
                            <!-- Informaci√≥n Personal -->
                            <div class="form-section">
                                <h5 class="section-title">Datos Personales</h5>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="firstName" class="form-label">Nombre *</label>
                                        <input type="text" class="form-control" id="firstName" name="firstName" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="lastName" class="form-label">Apellidos *</label>
                                        <input type="text" class="form-control" id="lastName" name="lastName" required>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label">Correo Electr√≥nico *</label>
                                        <input type="email" class="form-control" id="email" name="email" required>
                                        <small class="text-muted">Recibir√°s la confirmaci√≥n aqu√≠</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label">Tel√©fono *</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" placeholder="+506 8888-8888" required>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="idNumber" class="form-label">C√©dula o Identificaci√≥n *</label>
                                    <input type="text" class="form-control" id="idNumber" name="idNumber" placeholder="1-1234-5678" required>
                                </div>
                            </div>

                            <!-- Direcci√≥n de Env√≠o -->
                            <div class="form-section">
                                <h5 class="section-title">Direcci√≥n de Env√≠o</h5>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="province" class="form-label">Provincia *</label>
                                        <select class="form-select" id="province" name="province" required>
                                            <option value="">Seleccionar...</option>
                                            <option value="San Jos√©">San Jos√©</option>
                                            <option value="Alajuela">Alajuela</option>
                                            <option value="Cartago">Cartago</option>
                                            <option value="Heredia">Heredia</option>
                                            <option value="Guanacaste">Guanacaste</option>
                                            <option value="Puntarenas">Puntarenas</option>
                                            <option value="Lim√≥n">Lim√≥n</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="canton" class="form-label">Cant√≥n *</label>
                                        <input type="text" class="form-control" id="canton" name="canton" required>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="district" class="form-label">Distrito *</label>
                                        <input type="text" class="form-control" id="district" name="district" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="postalCode" class="form-label">C√≥digo Postal</label>
                                        <input type="text" class="form-control" id="postalCode" name="postalCode" placeholder="10101">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="address" class="form-label">Direcci√≥n Exacta *</label>
                                    <textarea class="form-control" id="address" name="address" rows="3" placeholder="Ej: De la Iglesia Cat√≥lica, 200m norte, casa amarilla port√≥n negro" required></textarea>
                                    <small class="text-muted">Por favor sea lo m√°s espec√≠fico posible</small>
                                </div>

                                <div class="mb-3">
                                    <label for="notes" class="form-label">Notas Adicionales (Opcional)</label>
                                    <textarea class="form-control" id="notes" name="notes" rows="2" placeholder="Ej: Llamar antes de llegar, port√≥n el√©ctrico"></textarea>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="form-actions">
                                <a href="cart.html" class="btn btn-outline-secondary">
                                    <svg width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                                    </svg>
                                    Volver al Carrito
                                </a>
                                <button type="submit" class="btn btn-dark btn-lg">
                                    Continuar al Pago
                                    <svg width="16" height="16" fill="currentColor" class="ms-2" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                                    </svg>
                                </button>
                            </div>
                        </form>

                        <!-- Pantalla de Pago SINPE (Oculta inicialmente) -->
                        <div id="payment-screen" class="payment-screen" style="display: none;">
                            <div class="payment-header">
                                <h2>Realizar Pago</h2>
                                <p class="lead">Completa tu pago de forma segura</p>
                            </div>

                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Pago por SINPE M√≥vil</h5>
                                            <div class="alert alert-info">
                                                <strong>üì± Instrucciones para pagar con SINPE M√≥vil:</strong>
                                                <ol class="mt-3 mb-0">
                                                    <li>Abre la aplicaci√≥n de tu banco</li>
                                                    <li>Selecciona SINPE M√≥vil o Transferencias</li>
                                                    <li>Ingresa el n√∫mero de tel√©fono de destino</li>
                                                    <li>Ingresa el monto exacto mostrado abajo</li>
                                                    <li>Completa la transferencia</li>
                                                    <li>Sube tu comprobante de pago</li>
                                                </ol>
                                            </div>
                                            <div class="sinpe-details">
                                                <div class="detail-box">
                                                    <label>N√∫mero SINPE M√≥vil:</label>
                                                    <div class="sinpe-number">
                                                        <strong>+506 8445-3904</strong>
                                                        <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('84453904', event)">Copiar</button>
                                                    </div>
                                                </div>
                                                <div class="detail-box">
                                                    <label>Nombre del beneficiario:</label>
                                                    <strong>Fraganze Perfumes S.A.</strong>
                                                </div>
                                                <div class="detail-box total-amount">
                                                    <label>Monto a transferir:</label>
                                                    <h3 class="text-primary mb-0" id="final-total">‚Ç°0</h3>
                                                </div>
                                                <div class="detail-box">
                                                    <label>N√∫mero de pedido:</label>
                                                    <strong id="order-number">-</strong>
                                                </div>
                                            </div>
                                            <div class="upload-proof mt-4">
                                                <h5 class="mb-3">Comprobante de Pago</h5>
                                                <div class="mb-3">
                                                    <label for="sinpe-reference" class="form-label">N√∫mero de Referencia o Comprobante SINPE *</label>
                                                    <input type="text" class="form-control" id="sinpe-reference" placeholder="Ej: 2024-02-001234 o n√∫mero de transacci√≥n" required>
                                                    <small class="text-muted">Este n√∫mero aparecer√° en tu comprobante de transferencia</small>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="payment-proof" class="form-label">Subir Comprobante (Imagen o PDF)</label>
                                                    <input type="file" class="form-control" id="payment-proof" accept="image/*,.pdf">
                                                    <small class="text-muted">Formatos aceptados: JPG, PNG, PDF (M√°x. 5MB)</small>
                                                </div>
                                            </div>
                                            <div class="form-actions mt-4">
                                                <button type="button" class="btn btn-outline-secondary" onclick="goBackToForm()">
                                                    <svg width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                                        <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                                                    </svg>
                                                    Editar Informaci√≥n
                                                </button>
                                                <button type="button" class="btn btn-success btn-lg" onclick="confirmPayment(event)">
                                                    <svg width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                                                    </svg>
                                                    Confirmar Pedido (WhatsApp)
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                            <h5 class="card-title mb-3">Pago por WhatsApp</h5>
                                            <p class="mb-3">Puedes confirmar tu pago y recibir asistencia directa por WhatsApp.</p>
                                            <a href="https://wa.me/50684453904?text=Hola,%20quiero%20confirmar%20mi%20pago." target="_blank" rel="noopener" class="btn btn-success btn-lg w-100 d-flex align-items-center justify-content-center" style="max-width: 320px;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                                    <path d="M13.601 2.326A7.956 7.956 0 0 0 8.002 0C3.584 0 .002 3.582.002 8c0 1.409.37 2.782 1.072 3.99L0 16l4.13-1.07A7.96 7.96 0 0 0 8.002 16c4.418 0 8-3.582 8-8 0-2.137-.833-4.146-2.399-5.674zM8.002 14.5c-1.295 0-2.567-.344-3.67-.995l-.262-.155-2.45.634.654-2.388-.17-.276A6.478 6.478 0 0 1 1.502 8c0-3.584 2.916-6.5 6.5-6.5 1.736 0 3.37.676 4.601 1.899A6.47 6.47 0 0 1 14.502 8c0 3.584-2.916 6.5-6.5 6.5zm3.13-4.13c-.17-.085-1.01-.497-1.166-.553-.156-.057-.27-.085-.384.085-.113.17-.44.553-.54.668-.099.113-.199.127-.369.042-.17-.085-.719-.265-1.37-.846-.507-.453-.85-1.012-.95-1.182-.099-.17-.011-.262.074-.347.076-.076.17-.199.255-.298.085-.099.113-.17.17-.284.057-.113.028-.213-.014-.298-.042-.085-.384-.927-.527-1.27-.139-.334-.28-.288-.384-.293-.099-.004-.213-.005-.327-.005a.63.63 0 0 0-.456.213c-.156.17-.599.585-.599 1.427 0 .842.614 1.656.699 1.77.085.113 1.21 1.85 2.936 2.522.411.177.73.283.98.362.412.132.787.113 1.083.069.33-.049 1.01-.413 1.153-.813.142-.399.142-.741.099-.813-.042-.07-.155-.113-.326-.198z"/>
                                                </svg>
                                                Pagar por WhatsApp
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pantalla de Confirmaci√≥n (Oculta inicialmente) -->
                        <div id="confirmation-screen" class="confirmation-screen" style="display: none;">
                            <div class="confirmation-icon">
                                <svg width="80" height="80" fill="currentColor" class="text-success" viewBox="0 0 16 16">
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                </svg>
                            </div>
                            <h2 class="text-success mb-3">¬°Pedido Confirmado!</h2>
                            <p class="lead">Gracias por tu compra en Fraganze</p>
                            
                            <div class="confirmation-details">
                                <p>Tu n√∫mero de pedido es: <strong id="confirmation-order-number">-</strong></p>
                                <p>Hemos enviado un correo de confirmaci√≥n a: <strong id="confirmation-email">-</strong></p>
                                <p class="text-muted mt-4">
                                    Procesaremos tu pago en las pr√≥ximas 24 horas. Una vez confirmado, 
                                    prepararemos tu pedido para el env√≠o. Te mantendremos informado v√≠a correo electr√≥nico.
                                </p>
                            </div>

                            <div class="form-actions mt-5">
                                <a href="index.html" class="btn btn-outline-secondary">Volver al Inicio</a>
                                <a href="shop.html" class="btn btn-dark">Seguir Comprando</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen del Pedido -->
                <div class="col-lg-5">
                    <div class="order-summary">
                        <h4 class="mb-4">Resumen del Pedido</h4>
                        
                        <div class="order-items" id="order-items">
                            <!-- Los items se cargan din√°micamente -->
                        </div>

                        <div class="order-totals mt-4">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="summary-subtotal">‚Ç°0</span>
                            </div>
                            <div class="total-row">
                                <span>Env√≠o:</span>
                                <span id="summary-shipping">‚Ç°0</span>
                            </div>
                            <div class="total-row">
                                <span>IVA (13%):</span>
                                <span id="summary-tax">‚Ç°0</span>
                            </div>
                            <hr>
                            <div class="total-row total-final">
                                <span><strong>Total:</strong></span>
                                <span><strong id="summary-total">‚Ç°0</strong></span>
                            </div>
                        </div>

                        <div class="security-badge mt-4">
                            <svg width="24" height="24" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                                <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
                                <path d="M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                            </svg>
                            <span>Compra 100% segura y protegida</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-5 bg-linear">
        <div class="container">
            <div class="text-center">
                <p class="mb-0">¬© 2023 Fraganze. Dise√±ado con ‚ù§Ô∏è para amantes de fragancias exclusivas.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/checkout.js"></script>
</body>
</html>
